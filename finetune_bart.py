import logging
from transformers import BartTokenizer, BartForConditionalGeneration, Trainer, TrainingArguments
from datasets import Dataset

logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')

finetune_data = [
    {"input": "Summarize the assignments in a formal tone for prompt 'What homework do I have?'. Use 24-hour time format and short sentences. Data: 【作業】[組合語言與計算機組織IN210] Floating-point numbers due 2025-06-13 23:59, 【作業】[資訊隱私IN211] Appreciation report (choose one out of five assignments) due 2025-06-16 16:00.", "output": "You have two assignments. Floating-point numbers is due June 13, 2025, at 23:59. Appreciation report is due June 16, 2025, at 16:00."},
    {"input": "Summarize the assignments in a casual tone for prompt 'Giv me HW'. Use 24-hour time format and short sentences. Data: 【作業】[組合語言與計算機組織IN210] Floating-point numbers due 2025-06-13 23:59, 【作業】[資訊隱私IN211] Appreciation report (choose one out of five assignments) due 2025-06-16 16:00.", "output": "Yo, you got two assignments. Floating-point numbers due June 13 at 23:59. Appreciation report due June 16 at 16:00."},
    {"input": "Summarize the activities in a formal tone for prompt 'Show me my upcoming events'. Use 24-hour time format and short sentences. Data: 元智大學EMI聯合成果展 EMI Joint Achievement Exhibition at Yuan Ze University due 2025-05-21 15:00, 國際校友系列講座I - 留台發展指南 due 2025-05-21 14:00.", "output": "You have two activities. EMI Joint Achievement Exhibition at Yuan Ze University is due May 21, 2025, at 15:00. International Alumni Series I is due May 21, 2025, at 14:00."},
    {"input": "Summarize the activities in a casual tone for prompt 'Gimme activities'. Use 24-hour time format and short sentences. Data: 元智大學EMI聯合成果展 EMI Joint Achievement Exhibition at Yuan Ze University due 2025-05-21 15:00, 國際校友系列講座I - 留台發展指南 due 2025-05-21 14:00.", "output": "Hey, you got two activities. EMI Exhibition at Yuan Ze due May 21 at 15:00. Alumni Series I due May 21 at 14:00."},
    {"input": "Summarize the assignments in a formal tone for prompt '顯示我的作業'. Use 24-hour time format and short sentences. Data: 【作業】[組合語言與計算機組織IN210] Floating-point numbers due 2025-06-13 23:59, 【作業】[資訊隱私IN211] Appreciation report (choose one out of five assignments) due 2025-06-16 16:00.", "output": "You have two assignments. Floating-point numbers is due June 13, 2025, at 23:59. Appreciation report is due June 16, 2025, at 16:00."},
    {"input": "Summarize the activities in a formal tone for prompt '有哪些活動？'. Use 24-hour time format and short sentences. Data: 國際校友系列講座I - 留台發展指南 due 2025-05-21 14:00, 國際校友系列講座II - 在臺就業實務分享 due 2025-05-23 14:00.", "output": "You have two activities. International Alumni Series I is due May 21, 2025, at 14:00. International Alumni Series II is due May 23, 2025, at 14:00."},
    {"input": "Summarize the assignments in a casual tone for prompt 'Any tasks due soon?'. Use 24-hour time format and short sentences. Data: 【作業】[組合語言與計算機組織IN210] Floating-point numbers due 2025-06-13 23:59.", "output": "Hey, you got one assignment. Floating-point numbers due June 13 at 23:59."},
    {"input": "Summarize the activities in a formal tone for prompt 'List activities for this week'. Use 24-hour time format and short sentences. Data: 【重新開放報名/5/20(二)EMI英文電影日】 due 2025-05-20 13:00, 元智大學EMI聯合成果展 due 2025-05-21 15:00.", "output": "You have two activities. EMI Movie Day is due May 20, 2025, at 13:00. EMI Joint Achievement Exhibition is due May 21, 2025, at 15:00."},
    {"input": "Summarize the assignments in a formal tone for prompt 'What homework do I have?'. Use 24-hour time format and short sentences. Data: 【作業】[資訊隱私IN211] Appreciation report (choose one out of five assignments) due 2025-06-16 16:00.", "output": "You have one assignment. Appreciation report is due June 16, 2025, at 16:00."},
    {"input": "Summarize the activities in a casual tone for prompt 'Show me my upcoming events'. Use 24-hour time format and short sentences. Data: 國際校友系列講座II - 在臺就業實務分享 due 2025-05-23 14:00.", "output": "Yo, you got one activity. Alumni Series II due May 23 at 14:00."},
    {"input": "Summarize the assignments in a formal tone for prompt '列出我的作業'. Use 24-hour time format and short sentences. Data: 【作業】[組合語言與計算機組織IN210] Floating-point numbers due 2025-06-13 23:59.", "output": "You have one assignment. Floating-point numbers is due June 13, 2025, at 23:59."},
    {"input": "Summarize the activities in a formal tone for prompt '顯示我的活動'. Use 24-hour time format and short sentences. Data: 元智大學EMI聯合成果展 EMI Joint Achievement Exhibition at Yuan Ze University due 2025-05-21 15:00.", "output": "You have one activity. EMI Joint Achievement Exhibition at Yuan Ze University is due May 21, 2025, at 15:00."},
    {"input": "Summarize the assignments in a casual tone for prompt 'give me HW'. Use 24-hour time format and short sentences. Data: 【作業】[資訊隱私IN211] Appreciation report (choose one out of five assignments) due 2025-06-16 16:00.", "output": "Yo, you got one assignment. Appreciation report due June 16 at 16:00."},
    {"input": "Summarize the activities in a casual tone for prompt 'List activities for this week'. Use 24-hour time format and short sentences. Data: 國際校友系列講座I - 留台發展指南 due 2025-05-21 14:00.", "output": "Hey, you got one activity. Alumni Series I due May 21 at 14:00."},
    {"input": "Summarize the assignments in a formal tone for prompt 'What homework do I have?'. Use 24-hour time format and short sentences. Data: 【作業】[組合語言與計算機組織IN210] Floating-point numbers due 2025-06-13 23:59, 【作業】[資訊隱私IN211] Appreciation report (choose one out of five assignments) due 2025-06-16 16:00, 【作業】[資料結構IN212] Tree Traversal due 2025-06-20 23:59.", "output": "You have three assignments. Floating-point numbers is due June 13, 2025, at 23:59. Appreciation report is due June 16, 2025, at 16:00. Tree Traversal is due June 20, 2025, at 23:59."},
    {"input": "Summarize the activities in a formal tone for prompt 'Show me my upcoming events'. Use 24-hour time format and short sentences. Data: 元智大學EMI聯合成果展 due 2025-05-21 15:00, 國際校友系列講座I due 2025-05-21 14:00.", "output": "You have two activities. EMI Joint Achievement Exhibition is due May 21, 2025, at 15:00. International Alumni Series I is due May 21, 2025, at 14:00."},
    {"input": "Summarize the assignments in a casual tone for prompt 'Giv me HW'. Use 24-hour time format and short sentences. Data: 【作業】[組合語言與計算機組織IN210] Floating-point numbers due 2025-06-13 23:59, 【作業】[資料結構IN212] Tree Traversal due 2025-06-20 23:59.", "output": "Yo, you got two assignments. Floating-point numbers due June 13 at 23:59. Tree Traversal due June 20 at 23:59."},
    {"input": "Summarize the activities in a formal tone for prompt '有哪些活動？'. Use 24-hour time format and short sentences. Data: 國際校友系列講座II - 在臺就業實務分享 due 2025-05-23 14:00, 【重新開放報名/5/20(二)EMI英文電影日】 due 2025-05-20 13:00.", "output": "You have two activities. International Alumni Series II is due May 23, 2025, at 14:00. EMI Movie Day is due May 20, 2025, at 13:00."},
    {"input": "Summarize the assignments in a formal tone for prompt '顯示我的作業'. Use 24-hour time format and short sentences. Data: 【作業】[資料結構IN212] Tree Traversal due 2025-06-20 23:59.", "output": "You have one assignment. Tree Traversal is due June 20, 2025, at 23:59."},
    {"input": "Summarize the activities in a casual tone for prompt 'Gimme activities'. Use 24-hour time format and short sentences. Data: 元智大學EMI聯合成果展 due 2025-05-21 15:00, 國際校友系列講座I due 2025-05-21 14:00.", "output": "Hey, you got two activities. EMI Exhibition due May 21 at 15:00. Alumni Series I due May 21 at 14:00."},
    {"input": "Summarize the assignments in a formal tone for prompt 'Any tasks due soon?'. Use 24-hour time format and short sentences. Data: 【作業】[組合語言與計算機組織IN210] Floating-point numbers due 2025-06-13 23:59, 【作業】[資訊隱私IN211] Appreciation report (choose one out of five assignments) due 2025-06-16 16:00.", "output": "You have two assignments. Floating-point numbers is due June 13, 2025, at 23:59. Appreciation report is due June 16, 2025, at 16:00."},
    {"input": "Summarize the activities in a formal tone for prompt 'List activities for this week'. Use 24-hour time format and short sentences. Data: 【重新開放報名/5/20(二)EMI英文電影日】 due 2025-05-20 13:00, 元智大學EMI聯合成果展 due 2025-05-21 15:00.", "output": "You have two activities. EMI Movie Day is due May 20, 2025, at 13:00. EMI Joint Achievement Exhibition is due May 21, 2025, at 15:00."},
    {"input": "Summarize the assignments in a casual tone for prompt 'give me HW'. Use 24-hour time format and short sentences. Data: 【作業】[資料結構IN212] Tree Traversal due 2025-06-20 23:59.", "output": "Yo, you got one assignment. Tree Traversal due June 20 at 23:59."},
    {"input": "Summarize the activities in a casual tone for prompt 'Show me my upcoming events'. Use 24-hour time format and short sentences. Data: 國際校友系列講座I - 留台發展指南 due 2025-05-21 14:00, 國際校友系列講座II - 在臺就業實務分享 due 2025-05-23 14:00.", "output": "Hey, you got two activities. Alumni Series I due May 21 at 14:00. Alumni Series II due May 23 at 14:00."},
    {"input": "Summarize the assignments in a formal tone for prompt 'What homework do I have?'. Use 24-hour time format and short sentences. Data: 【作業】[組合語言與計算機組織IN210] Floating-point numbers due 2025-06-13 23:59, 【作業】[資料結構IN212] Tree Traversal due 2025-06-20 23:59.", "output": "You have two assignments. Floating-point numbers is due June 13, 2025, at 23:59. Tree Traversal is due June 20, 2025, at 23:59."},
    {"input": "Summarize the activities in a formal tone for prompt '顯示我的活動'. Use 24-hour time format and short sentences. Data: 國際校友系列講座I - 留台發展指南 due 2025-05-21 14:00, 國際校友系列講座II - 在臺就業實務分享 due 2025-05-23 14:00.", "output": "You have two activities. International Alumni Series I is due May 21, 2025, at 14:00. International Alumni Series II is due May 23, 2025, at 14:00."},
    {"input": "Summarize the assignments in a formal tone for prompt 'What homework do I have?'. Use 24-hour time format and short sentences. Data: 【作業】[資料結構IN212] Tree Traversal due 2025-06-20 23:59.", "output": "You have one assignment. Tree Traversal is due June 20, 2025, at 23:59."},
    {"input": "Summarize the activities in a casual tone for prompt 'Gimme activities'. Use 24-hour time format and short sentences. Data: 【重新開放報名/5/20(二)EMI英文電影日】 due 2025-05-20 13:00.", "output": "Yo, you got one activity. EMI Movie Day due May 20 at 13:00."},
    {"input": "Summarize the assignments in a casual tone for prompt 'Any tasks due soon?'. Use 24-hour time format and short sentences. Data: 【作業】[組合語言與計算機組織IN210] Floating-point numbers due 2025-06-13 23:59, 【作業】[資料結構IN212] Tree Traversal due 2025-06-20 23:59.", "output": "Hey, you got two assignments. Floating-point numbers due June 13 at 23:59. Tree Traversal due June 20 at 23:59."},
    {"input": "Summarize the activities in a formal tone for prompt 'Show me my upcoming events'. Use 24-hour time format and short sentences. Data: 元智大學EMI聯合成果展 due 2025-05-21 15:00.", "output": "You have one activity. EMI Joint Achievement Exhibition is due May 21, 2025, at 15:00."},
    {"input": "Summarize the assignments in a formal tone for prompt '顯示我的作業'. Use 24-hour time format and short sentences. Data: 【作業】[組合語言與計算機組織IN210] Floating-point numbers due 2025-06-13 23:59, 【作業】[資料結構IN212] Tree Traversal due 2025-06-20 23:59.", "output": "You have two assignments. Floating-point numbers is due June 13, 2025, at 23:59. Tree Traversal is due June 20, 2025, at 23:59."},
    {"input": "Summarize the activities in a casual tone for prompt 'Gimme activities'. Use 24-hour time format and short sentences. Data: 國際校友系列講座II - 在臺就業實務分享 due 2025-05-23 14:00.", "output": "Yo, you got one activity. Alumni Series II due May 23 at 14:00."},
    {"input": "Summarize the assignments in a formal tone for prompt 'What homework do I have?'. Use 24-hour time format and short sentences. Data: 【作業】[資料結構IN212] Tree Traversal due 2025-06-20 23:59, 【作業】[資訊隱私IN211] Appreciation report (choose one out of five assignments) due 2025-06-16 16:00.", "output": "You have two assignments. Tree Traversal is due June 20, 2025, at 23:59. Appreciation report is due June 16, 2025, at 16:00."},
    {"input": "Summarize the activities in a formal tone for prompt '有哪些活動？'. Use 24-hour time format and short sentences. Data: 元智大學EMI聯合成果展 due 2025-05-21 15:00, 【重新開放報名/5/20(二)EMI英文電影日】 due 2025-05-20 13:00.", "output": "You have two activities. EMI Joint Achievement Exhibition is due May 21, 2025, at 15:00. EMI Movie Day is due May 20, 2025, at 13:00."},
    {"input": "Summarize the assignments in a casual tone for prompt 'give me HW'. Use 24-hour time format and short sentences. Data: 【作業】[組合語言與計算機組織IN210] Floating-point numbers due 2025-06-13 23:59, 【作業】[資訊隱私IN211] Appreciation report (choose one out of five assignments) due 2025-06-16 16:00.", "output": "Yo, you got two assignments. Floating-point numbers due June 13 at 23:59. Appreciation report due June 16 at 16:00."},
    {"input": "Summarize the activities in a casual tone for prompt 'List activities for this week'. Use 24-hour time format and short sentences. Data: 國際校友系列講座I - 留台發展指南 due 2025-05-21 14:00.", "output": "Hey, you got one activity. Alumni Series I due May 21 at 14:00."},
    {"input": "Summarize the assignments in a formal tone for prompt '列出我的作業'. Use 24-hour time format and short sentences. Data: 【作業】[資料結構IN212] Tree Traversal due 2025-06-20 23:59.", "output": "You have one assignment. Tree Traversal is due June 20, 2025, at 23:59."},
    {"input": "Summarize the activities in a formal tone for prompt 'Show me my upcoming events'. Use 24-hour time format and short sentences. Data: 國際校友系列講座II - 在臺就業實務分享 due 2025-05-23 14:00, 元智大學EMI聯合成果展 due 2025-05-21 15:00.", "output": "You have two activities. International Alumni Series II is due May 23, 2025, at 14:00. EMI Joint Achievement Exhibition is due May 21, 2025, at 15:00."},
    {"input": "Summarize the assignments in a casual tone for prompt 'Any tasks due soon?'. Use 24-hour time format and short sentences. Data: 【作業】[組合語言與計算機組織IN210] Floating-point numbers due 2025-06-13 23:59.", "output": "Hey, you got one assignment. Floating-point numbers due June 13 at 23:59."},
    {"input": "Summarize the activities in a casual tone for prompt 'Gimme activities'. Use 24-hour time format and short sentences. Data: 【重新開放報名/5/20(二)EMI英文電影日】 due 2025-05-20 13:00, 國際校友系列講座I due 2025-05-21 14:00.", "output": "Yo, you got two activities. EMI Movie Day due May 20 at 13:00. Alumni Series I due May 21 at 14:00."},
    {"input": "Summarize the assignments in a formal tone for prompt 'What homework do I have?'. Use 24-hour time format and short sentences. Data: 【作業】[組合語言與計算機組織IN210] Floating-point numbers due 2025-06-13 23:59, 【作業】[資料結構IN212] Tree Traversal due 2025-06-20 23:59, 【作業】[資訊隱私IN211] Privacy Essay due 2025-06-18 12:00.", "output": "You have three assignments. Floating-point numbers is due June 13, 2025, at 23:59. Tree Traversal is due June 20, 2025, at 23:59. Privacy Essay is due June 18, 2025, at 12:00."},
    {"input": "Summarize the activities in a formal tone for prompt '顯示我的活動'. Use 24-hour time format and short sentences. Data: 國際校友系列講座I - 留台發展指南 due 2025-05-21 14:00, 國際校友系列講座II - 在臺就業實務分享 due 2025-05-23 14:00, EMI Workshop due 2025-05-22 10:00.", "output": "You have three activities. International Alumni Series I is due May 21, 2025, at 14:00. International Alumni Series II is due May 23, 2025, at 14:00. EMI Workshop is due May 22, 2025, at 10:00."},
    {"input": "Summarize the assignments in a casual tone for prompt 'Giv me HW'. Use 24-hour time format and short sentences. Data: 【作業】[Math101] Algebra Quiz due 2025-06-15 09:00, 【作業】[Physics202] Lab Report due 2025-06-17 23:59.", "output": "Yo, you got two assignments. Algebra Quiz due June 15 at 09:00. Lab Report due June 17 at 23:59."},
    {"input": "Summarize the activities in a formal tone for prompt 'Show me my upcoming events'. Use 24-hour time format and short sentences. Data: Career Fair due 2025-05-25 13:00, Guest Lecture on AI due 2025-05-26 15:00.", "output": "You have two activities. Career Fair is due May 25, 2025, at 13:00. Guest Lecture on AI is due May 26, 2025, at 15:00."},
    {"input": "Summarize the assignments in a formal tone for prompt 'What homework do I have?'. Use 24-hour time format and short sentences. Data: 【作業】[CS303] Coding Project due 2025-06-14 23:59.", "output": "You have one assignment. Coding Project is due June 14, 2025, at 23:59."},
    {"input": "Summarize the activities in a casual tone for prompt 'Gimme activities'. Use 24-hour time format and short sentences. Data: Movie Night due 2025-05-20 19:00, Study Group due 2025-05-21 16:00, Club Meeting due 2025-05-22 18:00.", "output": "Yo, you got three activities. Movie Night due May 20 at 19:00. Study Group due May 21 at 16:00. Club Meeting due May 22 at 18:00."}
]

def main():
    logging.info("Starting fine-tuning of bart-base...")
    dataset = Dataset.from_list([{"input": d["input"], "output": d["output"]} for d in finetune_data])
    model_name = "facebook/bart-base"
    tokenizer = BartTokenizer.from_pretrained(model_name)
    model = BartForConditionalGeneration.from_pretrained(model_name)
    def preprocess_function(examples):
        inputs = examples["input"]
        targets = examples["output"]
        model_inputs = tokenizer(inputs, max_length=128, truncation=True, padding="max_length")
        labels = tokenizer(targets, max_length=128, truncation=True, padding="max_length")
        model_inputs["labels"] = labels["input_ids"]
        return model_inputs
    tokenized_dataset = dataset.map(preprocess_function, batched=True)
    training_args = TrainingArguments(
        output_dir="./bart-finetuned",
        num_train_epochs=20,
        per_device_train_batch_size=4,
        save_steps=10_000,
        save_total_limit=2,
        logging_steps=10,
        learning_rate=1e-5,
        weight_decay=0.01,
    )
    trainer = Trainer(
        model=model,
        args=training_args,
        train_dataset=tokenized_dataset,
    )
    trainer.train()
    model.save_pretrained("./bart-finetuned")
    tokenizer.save_pretrained("./bart-finetuned")
    logging.info("Fine-tuned model saved to ./bart-finetuned")

if __name__ == "__main__":
    main()